<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MapReduceåŸç† | zxj</title><meta name="keywords" content="Hadoop"><meta name="author" content="Xiangjie"><meta name="copyright" content="Xiangjie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="MapReduceæ¦‚è¿°MapReduceå®šä¹‰MapReduceæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘åŸºäºâ€œHadoopçš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚ MapReduceçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªHadoopé›†ç¾¤ä¸Šã€‚ MapReduceä¼˜ç¼ºç‚¹ä¼˜ç‚¹  æ˜“äºç¼–ç¨‹ è‰¯å¥½çš„æ‰©å±•æ€§(è®¡ç®—èµ„æº) é«˜å®¹é”™æ€§ é€‚åˆPBçº§ä»¥ä¸Šæ•°æ®çš„ç¦»çº¿å¤„ç†  ç¼º">
<meta property="og:type" content="article">
<meta property="og:title" content="MapReduceåŸç†">
<meta property="og:url" content="https://awslzhang.top/2020/06/26/MapReduce%E5%8E%9F%E7%90%86/index.html">
<meta property="og:site_name" content="zxj">
<meta property="og:description" content="MapReduceæ¦‚è¿°MapReduceå®šä¹‰MapReduceæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶ï¼Œæ˜¯ç”¨æˆ·å¼€å‘åŸºäºâ€œHadoopçš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚ MapReduceçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„åˆ†å¸ƒå¼è¿ç®—ç¨‹åºï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªHadoopé›†ç¾¤ä¸Šã€‚ MapReduceä¼˜ç¼ºç‚¹ä¼˜ç‚¹  æ˜“äºç¼–ç¨‹ è‰¯å¥½çš„æ‰©å±•æ€§(è®¡ç®—èµ„æº) é«˜å®¹é”™æ€§ é€‚åˆPBçº§ä»¥ä¸Šæ•°æ®çš„ç¦»çº¿å¤„ç†  ç¼º">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/06/27/2xbLZqNQKHGoUu1.jpg">
<meta property="article:published_time" content="2020-06-26T15:39:15.000Z">
<meta property="article:modified_time" content="2021-01-01T05:49:59.958Z">
<meta property="article:author" content="Xiangjie">
<meta property="article:tag" content="Hadoop">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/06/27/2xbLZqNQKHGoUu1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://awslzhang.top/2020/06/26/MapReduce%E5%8E%9F%E7%90%86/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":50,"languages":{"author":"ä½œè€…: Xiangjie","link":"é“¾æ¥: ","source":"æ¥æº: zxj","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2021-01-01 13:49:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/atom.xml" title="zxj" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">85</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">43</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">25</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ç›®å½•</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/06/27/2xbLZqNQKHGoUu1.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">zxj</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ç›®å½•</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MapReduceåŸç†</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2020-06-26T15:39:15.000Z" title="å‘è¡¨äº 2020-06-26 23:39:15">2020-06-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-01-01T05:49:59.958Z" title="æ›´æ–°äº 2021-01-01 13:49:59">2021-01-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">4.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>16åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MapReduceæ¦‚è¿°"><a href="#MapReduceæ¦‚è¿°" class="headerlink" title="MapReduceæ¦‚è¿°"></a>MapReduceæ¦‚è¿°</h1><h2 id="MapReduceå®šä¹‰"><a href="#MapReduceå®šä¹‰" class="headerlink" title="MapReduceå®šä¹‰"></a>MapReduceå®šä¹‰</h2><p>MapReduceæ˜¯ä¸€ä¸ª<font color="red">åˆ†å¸ƒå¼è¿ç®—ç¨‹åºçš„ç¼–ç¨‹æ¡†æ¶</font>ï¼Œæ˜¯ç”¨æˆ·å¼€å‘åŸºäºâ€œHadoopçš„æ•°æ®åˆ†æåº”ç”¨â€çš„æ ¸å¿ƒæ¡†æ¶ã€‚</p>
<p>MapReduceçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†<strong>ç”¨æˆ·ç¼–å†™çš„ä¸šåŠ¡é€»è¾‘ä»£ç å’Œè‡ªå¸¦é»˜è®¤ç»„ä»¶</strong>æ•´åˆæˆä¸€ä¸ªå®Œæ•´çš„<strong>åˆ†å¸ƒå¼è¿ç®—ç¨‹åº</strong>ï¼Œå¹¶å‘è¿è¡Œåœ¨ä¸€ä¸ªHadoopé›†ç¾¤ä¸Šã€‚</p>
<h2 id="MapReduceä¼˜ç¼ºç‚¹"><a href="#MapReduceä¼˜ç¼ºç‚¹" class="headerlink" title="MapReduceä¼˜ç¼ºç‚¹"></a>MapReduceä¼˜ç¼ºç‚¹</h2><p><strong>ä¼˜ç‚¹</strong></p>
<ol>
<li>æ˜“äºç¼–ç¨‹</li>
<li>è‰¯å¥½çš„æ‰©å±•æ€§(è®¡ç®—èµ„æº)</li>
<li>é«˜å®¹é”™æ€§</li>
<li>é€‚åˆPBçº§ä»¥ä¸Šæ•°æ®çš„ç¦»çº¿å¤„ç†</li>
</ol>
<p><strong>ç¼ºç‚¹(å®è´¨ï¼šè®¡ç®—é€Ÿåº¦æ…¢)</strong></p>
<ol>
<li>ä¸æ“…é•¿å®æ—¶è®¡ç®—ï¼šæ— æ³•å†æ¯«ç§’/ç§’çº§è¿”å›ç»“æœ</li>
<li>ä¸æ“…é•¿æµå¼è®¡ç®—ï¼šæµå¼è®¡ç®—çš„è¾“å…¥æ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œè€ŒMapReduceåªèƒ½å¤„ç†é™æ€æ•°æ®</li>
<li>ä¸æ“…é•¿DAG(æœ‰å‘å›¾)è®¡ç®—ï¼šå¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œåä¸€åº”ç”¨çš„è¾“å…¥ä¸ºå‰ä¸€ä¸ªçš„è¾“å‡ºã€‚è¿™é‡Œä½¿ç”¨MapReduceä¼šå¾ˆæ…¢ï¼Œå®ƒæ¯æ¬¡å°†ç»“æœéƒ½å†™å…¥ç£ç›˜</li>
</ol>
<h2 id="MapReudceæµç¨‹"><a href="#MapReudceæµç¨‹" class="headerlink" title="MapReudceæµç¨‹"></a>MapReudceæµç¨‹</h2><p><img src="https://i.loli.net/2020/07/02/LgUycWVrnBOZpfx.png" alt="image-20200702101011024"></p>
<ol>
<li>åˆ†å¸ƒå¼çš„è¿ç®—ç¨‹åºå¾€å¾€éœ€è¦åˆ†æˆè‡³å°‘2ä¸ªé˜¶æ®µã€‚</li>
<li>ç¬¬ä¸€ä¸ªé˜¶æ®µçš„MapTaskå¹¶å‘å®ä¾‹ï¼Œå®Œå…¨å¹¶è¡Œè¿è¡Œï¼Œäº’ä¸ç›¸å¹²ã€‚(é»˜è®¤ï¼šå¹¶è¡Œåº¦ç”±blockæ•°é‡å†³å®š)</li>
<li>ç¬¬äºŒä¸ªé˜¶æ®µçš„ReduceTaskå¹¶å‘å®ä¾‹äº’ä¸ç›¸å¹²ï¼Œä½†æ˜¯ä»–ä»¬çš„æ•°æ®ä¾èµ–äºä¸Šä¸€ä¸ªé˜¶æ®µçš„æ‰€æœ‰MapTaskå¹¶å‘å®ä¾‹çš„éƒ¨åˆ†è¾“å‡º(æŒ‡å®šåˆ†åŒº)</li>
<li>MapReduceç¼–ç¨‹æ¨¡å‹åªèƒ½åŒ…å«ä¸€ä¸ªMapé˜¶æ®µå’Œä¸€ä¸ªReduceé˜¶æ®µï¼Œå¦‚æœç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘éå¸¸å¤æ‚ï¼Œé‚£å°±åªèƒ½å¤šä¸ªMapReduceç¨‹åºï¼Œä¸²è¡Œè¿è¡Œã€‚</li>
</ol>
<h2 id="MapReduceè¿›ç¨‹"><a href="#MapReduceè¿›ç¨‹" class="headerlink" title="MapReduceè¿›ç¨‹"></a>MapReduceè¿›ç¨‹</h2><p>ä¸€ä¸ªå®Œæ•´çš„MapReduceç¨‹åºåœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æœ‰ä¸‰ç±»å®ä¾‹è¿›ç¨‹ï¼š</p>
<ol>
<li><code>MrAppMaster</code>ï¼šè´Ÿè´£æ•´ä¸ªç¨‹åºçš„è¿‡ç¨‹è°ƒåº¦åŠçŠ¶æ€åè°ƒ</li>
<li><code>MapTask</code>ï¼šè´Ÿè´£Mapé˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹</li>
<li><code>ReduceTask</code>ï¼šè´Ÿè´£Reduceé˜¶æ®µçš„æ•´ä¸ªæ•°æ®å¤„ç†æµç¨‹</li>
</ol>
<h2 id="MapReduceåºåˆ—åŒ–"><a href="#MapReduceåºåˆ—åŒ–" class="headerlink" title="MapReduceåºåˆ—åŒ–"></a>MapReduceåºåˆ—åŒ–</h2><p>MapReduceç¨‹åºç”±ä¸‰éƒ¨åˆ†æ„æˆï¼šMapç±»ã€Reduceç±»å’Œé©±åŠ¨ç±»ã€‚ä¸”æ•°æ®çš„ç±»å‹æ˜¯Hadoopè‡ªèº«å°è£…çš„åºåˆ—åŒ–ç±»å‹ã€‚</p>
<p><strong>å¸¸ç”¨æ•°æ®åºåˆ—åŒ–ç±»å‹</strong></p>
<table>
<thead>
<tr>
<th><strong>Javaç±»å‹</strong></th>
<th><strong>Hadoop Writableç±»å‹</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Boolean</td>
<td>BooleanWritable</td>
</tr>
<tr>
<td>Byte</td>
<td>ByteWritable</td>
</tr>
<tr>
<td>Int</td>
<td>IntWritable</td>
</tr>
<tr>
<td>Float</td>
<td>FloatWritable</td>
</tr>
<tr>
<td>Long</td>
<td>LongWritable</td>
</tr>
<tr>
<td>Double</td>
<td>DoubleWritable</td>
</tr>
<tr>
<td>String</td>
<td>Text</td>
</tr>
<tr>
<td>Map</td>
<td>MapWritable</td>
</tr>
<tr>
<td>Array</td>
<td>ArrayWritable</td>
</tr>
</tbody></table>
<h3 id="è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£ï¼ˆWritableï¼‰"><a href="#è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£ï¼ˆWritableï¼‰" class="headerlink" title="è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£ï¼ˆWritableï¼‰"></a>è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£ï¼ˆWritableï¼‰</h3><p>åœ¨ä¼ä¸šå¼€å‘ä¸­å¾€å¾€å¸¸ç”¨çš„åŸºæœ¬åºåˆ—åŒ–ç±»å‹ä¸èƒ½æ»¡è¶³æ‰€æœ‰éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨Hadoopæ¡†æ¶å†…éƒ¨ä¼ é€’ä¸€ä¸ªbeanå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±éœ€è¦å®ç°åºåˆ—åŒ–æ¥å£ã€‚</p>
<p>å…·ä½“å®ç°beanå¯¹è±¡åºåˆ—åŒ–æ­¥éª¤å¦‚ä¸‹7æ­¥ã€‚</p>
<ol>
<li>å¿…é¡»å®ç°Writableæ¥å£</li>
<li>ååºåˆ—åŒ–æ—¶ï¼Œéœ€è¦åå°„è°ƒç”¨ç©ºå‚æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å¿…é¡»æœ‰ç©ºå‚æ„é€ </li>
<li>é‡å†™åºåˆ—åŒ–æ–¹æ³•</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    out.writeLong(upFlow);</span><br><span class="line">    out.writeLong(downFlow);</span><br><span class="line">    out.writeLong(sumFlow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é‡å†™ååºåˆ—åŒ–æ–¹æ³•</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput in)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    upFlow = in.readLong();</span><br><span class="line">    downFlow = in.readLong();</span><br><span class="line">    sumFlow = in.readLong();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æ³¨æ„ååºåˆ—åŒ–çš„é¡ºåºå’Œåºåˆ—åŒ–çš„é¡ºåºå®Œå…¨ä¸€è‡´</li>
<li>è¦æƒ³æŠŠç»“æœæ˜¾ç¤ºåœ¨æ–‡ä»¶ä¸­ï¼Œéœ€è¦é‡å†™toString()ï¼Œå¯ç”¨â€\tâ€åˆ†å¼€ï¼Œæ–¹ä¾¿åç»­ç”¨ã€‚</li>
<li>å¦‚æœéœ€è¦å°†è‡ªå®šä¹‰çš„beanæ”¾åœ¨keyä¸­ä¼ è¾“ï¼Œåˆ™è¿˜éœ€è¦å®ç°<code>Comparable</code>æ¥å£ï¼Œå› ä¸ºMapReduceæ¡†ä¸­çš„Shuffleè¿‡ç¨‹è¦æ±‚å¯¹keyå¿…é¡»èƒ½æ’åºã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(FlowBean o)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å€’åºæ’åˆ—ï¼Œä»å¤§åˆ°å°</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.sumFlow &gt; o.getSumFlow() ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="MapReduceç¼–ç¨‹è§„èŒƒ"><a href="#MapReduceç¼–ç¨‹è§„èŒƒ" class="headerlink" title="MapReduceç¼–ç¨‹è§„èŒƒ"></a>MapReduceç¼–ç¨‹è§„èŒƒ</h2><p><strong>Mapperé˜¶æ®µ</strong></p>
<ol>
<li>è‡ªå®šä¹‰çš„Mapperç»§æ‰¿çˆ¶ç±»Mapper, å››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºè¾“å…¥çš„k-v(InputFormatç”Ÿæˆçš„kv)ï¼Œmapæ˜ å°„å®Œæˆåè¾“å‡ºçš„k-vï¼›</li>
<li>Mapperçš„è¾“å…¥æ•°æ®æ˜¯KVæ ¼å¼æ•°æ®(å…·ä½“çœ‹ä½ ä½¿ç”¨ä»€ä¹ˆ<code>InputFormat</code>)</li>
<li>ä¸šåŠ¡é€»è¾‘å†™å…¥<code>map(xxx)</code>æ–¹æ³•</li>
<li>Mapperçš„è¾“å‡ºæ˜¯KVæ ¼å¼</li>
<li><code>map(xxx)</code>æ–¹æ³•(MapTaskè¿›ç¨‹)å¯¹æ¯ä¸€ä¸ªKVè°ƒç”¨ä¸€æ¬¡</li>
</ol>
<p><strong>Reduceré˜¶æ®µ</strong></p>
<ol>
<li>è‡ªå®šä¹‰çš„Reducerç»§æ‰¿çˆ¶ç±»Reducerï¼Œå‚æ•°åˆ†åˆ«ä¸ºMapperçš„è¾“å‡ºå’Œæœ€ç»ˆè¾“å‡º</li>
<li>Reducerçš„è¾“å…¥æ•°æ®æ˜¯KVæ ¼å¼æ•°æ®</li>
<li>ä¸šåŠ¡é€»è¾‘å†™å…¥<code>reduce(xxx)</code>æ–¹æ³•</li>
<li>ReduceTaskè¿›ç¨‹å¯¹æ¯ä¸€ç»„ç›¸åŒkçš„kvç»„è°ƒç”¨ä¸€æ¬¡reduce()æ–¹æ³•</li>
</ol>
<p><strong>Driveré˜¶æ®µ</strong></p>
<p>ç›¸å½“äºYARNé›†ç¾¤çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæäº¤æˆ‘ä»¬æ•´ä¸ªç¨‹åºåˆ°Yarné›†ç¾¤ï¼Œæäº¤çš„æ˜¯å°è£…äº†MapReduceç¨‹åºç›¸å…³è¿è¡Œå‚æ•°çš„jobå¯¹è±¡</p>
<hr>
<h3 id="ä»£ç å±•ç¤ºwordcount"><a href="#ä»£ç å±•ç¤ºwordcount" class="headerlink" title="ä»£ç å±•ç¤ºwordcount"></a>ä»£ç å±•ç¤ºwordcount</h3><ol>
<li>MapReduceç¨‹åºçš„æµç¨‹æ˜¯ï¼Œé¦–å…ˆæ ¹æ®è¾“å…¥ç›®å½•/æ–‡ä»¶ï¼Œç„¶åé€šè¿‡é»˜è®¤çš„<code>InputFormat(TextInputFormat)</code>æˆ–è€…æŒ‡å®šéœ€è¦çš„<code>InputFormat</code>å°†æ–‡ä»¶å¤„ç†ä¸ºk=æ¯è¡Œè¡Œé¦–åç§»é‡ï¼Œvalue=æ¯è¡Œçš„å†…å®¹</li>
<li>å°†<code>InputFormat</code>å¤„ç†åçš„KVäº¤ç»™Map Taskæ¥å¤„ç†ï¼ŒMap Taskå£°æ˜æ—¶çš„æ³›å‹åº”è¯¥ä¾æ¬¡ä¸º<code>InputFormat</code>çš„è¾“å‡ºKVã€Map Taskè¾“å‡ºçš„KV</li>
<li>å°†MapTaskå¤„ç†åçš„KVäº¤ç»™Reduce Taskæ¥æ‰§è¡Œä»»åŠ¡ï¼Œè€ŒReduce Taskå£°æ˜æ—¶å€™çš„æ³›å‹åº”è¯¥ä¾æ¬¡ä¸ºMap Taskè¾“å‡ºçš„KVï¼Œæœ€ç»ˆè¾“å‡ºçš„KVï¼ŒReduce Taskçš„å¤„ç†å‡½æ•°<code>reduce</code>çš„æ–¹æ³•å‚æ•°æ˜¯MapTaskçš„Kå’Œç»„æˆè¿­ä»£çš„Vã€‚</li>
<li>å°†ReduceTaskå¤„ç†åçš„KVäº¤ç»™é»˜è®¤çš„<code>OutputFormat(TextOutputFormat)</code>å°†KVè¾“å…¥æ–‡ä»¶ã€‚</li>
</ol>
<p><strong>Mapper</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * mrç¨‹åºä¸­ä¸å¾—ä½¿ç”¨Javaçš„åŸºç¡€ç±»ï¼Œå¾—ä½¿ç”¨mræä¾›çš„åºåˆ—åŒ–ç±»</span></span><br><span class="line"><span class="comment"> * ç¼–å†™Mapç¨‹åº:</span></span><br><span class="line"><span class="comment"> * 1. ç»§æ‰¿çˆ¶ç±»Mapper(), å››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºè¾“å…¥çš„k-vï¼Œmapæ˜ å°„å®Œæˆåè¾“å‡ºçš„k-vï¼›(TextInputFormaté»˜è®¤)è¾“å…¥çš„k-væ˜¯æ–‡ä»¶æ¯è¡Œçš„åç§»é‡å’Œæ¯è¡Œå†…å®¹</span></span><br><span class="line"><span class="comment"> * 2. é‡å†™çˆ¶ç±»çš„map()æ–¹æ³•ã€‚contextæ˜¯æ­¤æ¬¡Mapç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Map</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IntWritable num = <span class="keyword">new</span> IntWritable(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Text text = <span class="keyword">new</span> Text();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¯ä¸€è¡Œæ•°æ®ä¼šè°ƒç”¨ä¸€æ¬¡mapæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException,</span></span><br><span class="line"><span class="function">            InterruptedException </span>&#123;</span><br><span class="line">        String[] s = value.toString().split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s1 : s) &#123;</span><br><span class="line">         <span class="comment">//</span></span><br><span class="line">            text.set(s1);</span><br><span class="line">            context.write(text, num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Reducer</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * mrç¨‹åºä¸­ä¸å¾—ä½¿ç”¨Javaçš„åŸºç¡€ç±»ï¼Œå¾—ä½¿ç”¨mræä¾›çš„åºåˆ—åŒ–ç±»</span></span><br><span class="line"><span class="comment"> * ç¼–å†™Reducerç¨‹åº:</span></span><br><span class="line"><span class="comment"> * 1. ç»§æ‰¿çˆ¶ç±»Reducer(), å››ä¸ªå‚æ•°åˆ†åˆ«ä¸ºmapè¾“å‡ºçš„k-vï¼Œreduceè¾“å‡ºçš„k-vï¼›</span></span><br><span class="line"><span class="comment"> * 2. é‡å†™çˆ¶ç±»çš„reduce()æ–¹æ³•ã€‚contextæ˜¯æ­¤æ¬¡reduceç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reducer</span> <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">hadoop</span>.<span class="title">mapreduce</span>.<span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">IntWritable</span>, <span class="title">Text</span>, <span class="title">IntWritable</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IntWritable intWritable = <span class="keyword">new</span> IntWritable();</span><br><span class="line">    <span class="comment">// æ¯ä¸€ç»„ç›¸åŒçš„keyä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œvalueæ˜¯ç›¸åŒçš„keyçš„valueçš„ç»„åˆ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (IntWritable value : values) &#123;</span><br><span class="line">            sum += value.get();</span><br><span class="line">        &#125;</span><br><span class="line">        intWritable.set(sum);</span><br><span class="line">        context.write(key, intWritable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Driver</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Driver</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException,</span></span><br><span class="line"><span class="function">            InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//1. è·å–ä¸€ä¸ªJobå®ä¾‹</span></span><br><span class="line">        Job job = Job.getInstance(<span class="keyword">new</span> Configuration());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. è®¾ç½®æˆ‘ä»¬çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰</span></span><br><span class="line">        job.setJarByClass(Driver.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. è®¾ç½®Mapperå’ŒReducer</span></span><br><span class="line">        job.setMapperClass(Map.class);</span><br><span class="line">        job.setReducerClass(Reducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. è®¾ç½®Mapperå’ŒReducer è¾“å‡ºçš„ç±»å‹</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ”¹inputFormat/outputFormat</span></span><br><span class="line"><span class="comment">//        job.setOutputFormatClass(SequenceFileOutputFormat.class);</span></span><br><span class="line"><span class="comment">//        job.setInputFormatClass(TextInputFormat.class);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. è®¾ç½®è¾“å…¥è¾“å‡ºæ•°æ®</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="string">&quot;E:\\input&quot;</span>);</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">&quot;E:\\input874&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. æäº¤æˆ‘ä»¬çš„Job</span></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(b ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="Driverä¼˜åŒ–å†™æ³•"><a href="#Driverä¼˜åŒ–å†™æ³•" class="headerlink" title="Driverä¼˜åŒ–å†™æ³•"></a>Driverä¼˜åŒ–å†™æ³•</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·¥å…·ç±»å°†Driverç±»åˆ‡åˆ†ä¸ºmainå’Œtoolè®¾ç½®ï¼Œæ— éœ€ç›´æ¥åœ¨mainæ–¹æ³•ä¸­å†™å…¥è¿‡å¤šçš„é…ç½®ï¼š</p>
<p><strong>main</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.ToolRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// ToolRunnerå¯ä»¥è¿è¡ŒMR</span></span><br><span class="line">        ToolRunner.run(<span class="keyword">new</span> WordCountMRTool(), args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Tool</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.util.Tool;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCountMRTool</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line">    <span class="comment">// stringså°±æ˜¯mainçš„argså‚æ•°</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] strings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//1. è·å–ä¸€ä¸ªJobå®ä¾‹</span></span><br><span class="line">        Job job = Job.getInstance();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. è®¾ç½®æˆ‘ä»¬çš„ç±»è·¯å¾„ï¼ˆClasspathï¼‰</span></span><br><span class="line">        job.setJarByClass(WordCountMRTool.class);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3. è®¾ç½®Mapperå’ŒReducer</span></span><br><span class="line">        job.setMapperClass(Map.class);</span><br><span class="line">        job.setReducerClass(Reducer.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. è®¾ç½®Mapperå’ŒReducer è¾“å‡ºçš„ç±»å‹</span></span><br><span class="line">        job.setMapOutputKeyClass(Text.class);</span><br><span class="line">        job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(IntWritable.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. è®¾ç½®è¾“å…¥è¾“å‡ºæ•°æ®</span></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="string">&quot;E:\\input&quot;</span>);</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(<span class="string">&quot;E:\\input444&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6. æäº¤æˆ‘ä»¬çš„Job</span></span><br><span class="line">        <span class="keyword">boolean</span> b = job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> b ? JobStatus.State.SUCCEEDED.getValue() : JobStatus.State.FAILED.getValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setConf</span><span class="params">(Configuration configuration)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Configuration <span class="title">getConf</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ç§ä»£ç æœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯ç¬¬äºŒç§çœ‹èµ·æ¥æ¯”è¾ƒå¥½ã€‚</p>
<h1 id="MapReduceæ¡†æ¶åŸç†"><a href="#MapReduceæ¡†æ¶åŸç†" class="headerlink" title="MapReduceæ¡†æ¶åŸç†"></a>MapReduceæ¡†æ¶åŸç†</h1><h2 id="InputFormat"><a href="#InputFormat" class="headerlink" title="InputFormat"></a>InputFormat</h2><h3 id="FileInputFormatåˆ‡ç‰‡"><a href="#FileInputFormatåˆ‡ç‰‡" class="headerlink" title="FileInputFormatåˆ‡ç‰‡"></a>FileInputFormatåˆ‡ç‰‡</h3><p><img src="https://i.loli.net/2020/06/27/jg8ymAwIrU4M5uk.png" alt="image-20200627105459017"></p>
<p><strong>åˆ‡ç‰‡ä¸MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶</strong></p>
<p><strong>é—®é¢˜å¼•å‡º</strong></p>
<p>æ€è€ƒï¼š1Gçš„æ•°æ®ï¼Œå¯åŠ¨8ä¸ªMapTaskï¼Œå¯ä»¥æé«˜é›†ç¾¤çš„å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚é‚£ä¹ˆ1Kçš„æ•°æ®ï¼Œä¹Ÿå¯åŠ¨8ä¸ªMapTaskï¼Œä¼šæé«˜é›†ç¾¤æ€§èƒ½å—ï¼ŸMapTaskå¹¶è¡Œä»»åŠ¡æ˜¯å¦è¶Šå¤šè¶Šå¥½å‘¢ï¼Ÿå“ªäº›å› ç´ å½±å“äº†MapTaskå¹¶è¡Œåº¦ï¼Ÿ       </p>
<p>MapTaskå¹¶è¡Œåº¦å†³å®šæœºåˆ¶ï¼š</p>
<p><strong>æ•°æ®å—ï¼š</strong>Blockæ˜¯HDFSç‰©ç†ä¸ŠæŠŠæ•°æ®åˆ†æˆä¸€å—ä¸€å—ã€‚</p>
<p><strong>æ•°æ®åˆ‡ç‰‡ï¼š</strong>æ•°æ®åˆ‡ç‰‡åªæ˜¯åœ¨é€»è¾‘ä¸Šå¯¹è¾“å…¥è¿›è¡Œåˆ†ç‰‡ï¼Œå¹¶ä¸ä¼šåœ¨ç£ç›˜ä¸Šå°†å…¶åˆ‡åˆ†æˆç‰‡è¿›è¡Œå­˜å‚¨ã€‚</p>
<p>ä¸€ä¸ªMapTaskå¤„ç†ä¸€ä¸ªåˆ‡ç‰‡ï¼Œé»˜è®¤åˆ‡ç‰‡å¤§å°=æ•°æ®å—å¤§å°</p>
<p><strong>Jobæäº¤æµç¨‹</strong></p>
<p><img src="https://i.loli.net/2020/06/27/35BAYkgES6qimFW.png" alt="image-20200627105835689"></p>
<h4 id="FileInputFormatåˆ‡ç‰‡æœºåˆ¶"><a href="#FileInputFormatåˆ‡ç‰‡æœºåˆ¶" class="headerlink" title="FileInputFormatåˆ‡ç‰‡æœºåˆ¶"></a>FileInputFormatåˆ‡ç‰‡æœºåˆ¶</h4><ol>
<li>ç®€å•çš„æŒ‰ç…§æ–‡ä»¶å†…å®¹é•¿åº¦è¿›è¡Œåˆ‡åˆ†</li>
<li>åˆ‡ç‰‡å¤§å°ï¼Œé»˜è®¤ç­‰äºBlockå¤§å°</li>
<li>åˆ‡ç‰‡æ—¶ä¸è€ƒè™‘æ•°æ®é›†æ•´ä½“ï¼Œè€Œæ˜¯é€ä¸ªé’ˆå¯¹æ¯ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œåˆ‡åˆ†</li>
</ol>
<p>FileInputFormatçš„å®ç°ç±»æœ‰ï¼š<code>TextInputFormat</code>ã€<code>KeyValueTextInputFormat</code>ã€<code>NLineInputFormat</code>ã€<code>CombineTextInputFormat</code>å’Œè‡ªå®šä¹‰InputFormatç­‰ã€‚</p>
<p>ä¸Šè¿°å„ä¸ªå­ç±»æœ‰çš„ä½¿ç”¨äº†FileInputFormatçš„åˆ‡ç‰‡æœºåˆ¶(<code>TextInputFormat</code>ã€<code>KeyValueTextInputFormat</code>ã€<code>NLineInputFormat</code>)ï¼Œç‰¹åˆ«çš„<code>CombineTextInputFormat</code>[è‡ªå®šä¹‰äº†ä¸€å¥—åˆ‡ç‰‡æœºåˆ¶](# CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶)ã€‚</p>
<h4 id="CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶"><a href="#CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶" class="headerlink" title="CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶"></a>CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶</h4><p>æ¡†æ¶é»˜è®¤çš„TextInputFormatåˆ‡ç‰‡æœºåˆ¶æ˜¯å¯¹ä»»åŠ¡æŒ‰æ–‡ä»¶è§„åˆ’åˆ‡ç‰‡ï¼Œ<font color="red">ä¸ç®¡æ–‡ä»¶å¤šå°ï¼Œéƒ½ä¼šæ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ‡ç‰‡</font>ï¼Œéƒ½ä¼šäº¤ç»™ä¸€ä¸ªMapTaskï¼Œè¿™æ ·å¦‚æœæœ‰å¤§é‡å°æ–‡ä»¶ï¼Œå°±<font color="red">ä¼šäº§ç”Ÿå¤§é‡çš„MapTask</font>ï¼Œå¤„ç†æ•ˆç‡æå…¶ä½ä¸‹ã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<p>CombineTextInputFormatç”¨äºå°æ–‡ä»¶è¿‡å¤šçš„åœºæ™¯ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªå°æ–‡ä»¶ä»é€»è¾‘ä¸Šè§„åˆ’åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­ï¼Œè¿™æ ·ï¼Œå¤šä¸ªå°æ–‡ä»¶å°±å¯ä»¥äº¤ç»™ä¸€ä¸ªMapTaskå¤„ç†ã€‚</p>
<p><strong>è™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®</strong></p>
<p>CombineTextInputFormat.setMaxInputSplitSize(job, 4194304);// 4m</p>
<p>æ³¨æ„ï¼šè™šæ‹Ÿå­˜å‚¨åˆ‡ç‰‡æœ€å¤§å€¼è®¾ç½®æœ€å¥½æ ¹æ®å®é™…çš„å°æ–‡ä»¶å¤§å°æƒ…å†µæ¥è®¾ç½®å…·ä½“çš„å€¼ã€‚</p>
<p><strong>åˆ‡ç‰‡æœºåˆ¶</strong></p>
<p><img src="https://i.loli.net/2020/06/27/6EzDF5hqc8LIxwU.png" alt="image-20200627114202060"></p>
<p><strong>è™šæ‹Ÿå­˜å‚¨è¿‡ç¨‹ï¼š</strong></p>
<p>å°†è¾“å…¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å¤§å°ï¼Œä¾æ¬¡å’Œè®¾ç½®çš„setMaxInputSplitSizeå€¼æ¯”è¾ƒï¼Œå¦‚æœä¸å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ï¼Œé€»è¾‘ä¸Šåˆ’åˆ†ä¸€ä¸ªå—ã€‚å¦‚æœè¾“å…¥æ–‡ä»¶å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ä¸”å¤§äºä¸¤å€ï¼Œé‚£ä¹ˆä»¥æœ€å¤§å€¼åˆ‡å‰²ä¸€å—ï¼›<font color="red">å½“å‰©ä½™æ•°æ®å¤§å°è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼ä¸”ä¸å¤§äºæœ€å¤§å€¼2å€ï¼Œæ­¤æ—¶å°†æ–‡ä»¶å‡åˆ†æˆ2ä¸ªè™šæ‹Ÿå­˜å‚¨å—ï¼ˆé˜²æ­¢å‡ºç°å¤ªå°åˆ‡ç‰‡ï¼‰ã€‚</font></p>
<p>ä¾‹å¦‚setMaxInputSplitSizeå€¼ä¸º4Mï¼Œè¾“å…¥æ–‡ä»¶å¤§å°ä¸º8.02Mï¼Œåˆ™å…ˆé€»è¾‘ä¸Šåˆ†æˆä¸€ä¸ª4Mã€‚å‰©ä½™çš„å¤§å°ä¸º4.02Mï¼Œå¦‚æœæŒ‰ç…§4Mé€»è¾‘åˆ’åˆ†ï¼Œå°±ä¼šå‡ºç°0.02Mçš„å°çš„è™šæ‹Ÿå­˜å‚¨æ–‡ä»¶ï¼Œæ‰€ä»¥å°†å‰©ä½™çš„4.02Mæ–‡ä»¶åˆ‡åˆ†æˆï¼ˆ2.01Må’Œ2.01Mï¼‰ä¸¤ä¸ªæ–‡ä»¶ã€‚</p>
<p><strong>åˆ‡ç‰‡è¿‡ç¨‹ï¼š</strong></p>
<p>åˆ¤æ–­è™šæ‹Ÿå­˜å‚¨çš„æ–‡ä»¶å¤§å°æ˜¯å¦å¤§äºsetMaxInputSplitSizeå€¼ï¼Œå¤§äºç­‰äºåˆ™å•ç‹¬å½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</p>
<p>å¦‚æœä¸å¤§äºåˆ™è·Ÿä¸‹ä¸€ä¸ªè™šæ‹Ÿå­˜å‚¨æ–‡ä»¶è¿›è¡Œåˆå¹¶ï¼Œå…±åŒå½¢æˆä¸€ä¸ªåˆ‡ç‰‡ã€‚</p>
<p><strong>æµ‹è¯•ä¸¾ä¾‹</strong></p>
<p>æœ‰4ä¸ªå°æ–‡ä»¶å¤§å°åˆ†åˆ«ä¸º1.7Mã€5.1Mã€3.4Mä»¥åŠ6.8Mè¿™å››ä¸ªå°æ–‡ä»¶</p>
<p>åˆ™è™šæ‹Ÿå­˜å‚¨ä¹‹åå½¢æˆ6ä¸ªæ–‡ä»¶å—ï¼Œå¤§å°åˆ†åˆ«ä¸ºï¼š</p>
<p>1.7Mï¼Œï¼ˆ2.55Mã€2.55Mï¼‰ï¼Œ3.4Mä»¥åŠï¼ˆ3.4Mã€3.4Mï¼‰</p>
<p>æœ€ç»ˆä¼šå½¢æˆ3ä¸ªåˆ‡ç‰‡ï¼Œå¤§å°åˆ†åˆ«ä¸ºï¼š</p>
<p>ï¼ˆ1.7+2.55ï¼‰Mï¼Œï¼ˆ2.55+3.4ï¼‰Mï¼Œï¼ˆ3.4+3.4ï¼‰M</p>
<h3 id="FileInputFormatçš„RecordReaderç”ŸæˆK-V"><a href="#FileInputFormatçš„RecordReaderç”ŸæˆK-V" class="headerlink" title="FileInputFormatçš„RecordReaderç”ŸæˆK-V"></a>FileInputFormatçš„RecordReaderç”ŸæˆK-V</h3><p>FileInputFormatçš„å®ç°ç±»æœ‰ï¼š<code>TextInputFormat</code>ã€<code>KeyValueTextInputFormat</code>ã€<code>NLineInputFormat</code>ã€<code>CombineTextInputFormat</code>å’Œè‡ªå®šä¹‰InputFormatç­‰ã€‚</p>
<p>ä¸Šè¿°å„ä¸ªå­ç±»æœ‰çš„ä½¿ç”¨äº†FileInputFormatçš„åˆ‡ç‰‡æœºåˆ¶(<code>TextInputFormat</code>ã€<code>KeyValueTextInputFormat</code>ã€<code>NLineInputFormat</code>)ï¼Œç‰¹åˆ«çš„<code>CombineTextInputFormat</code>[è‡ªå®šä¹‰äº†ä¸€å¥—åˆ‡ç‰‡æœºåˆ¶](# CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶)ã€‚</p>
<h4 id="KeyValueTextInputFormatçš„RecordReaderç”ŸæˆK-V"><a href="#KeyValueTextInputFormatçš„RecordReaderç”ŸæˆK-V" class="headerlink" title="KeyValueTextInputFormatçš„RecordReaderç”ŸæˆK-V"></a>KeyValueTextInputFormatçš„RecordReaderç”ŸæˆK-V</h4><p>æ¯ä¸€è¡Œå‡ä¸ºä¸€æ¡è®°å½•ï¼Œè¢«åˆ†å‰²ç¬¦åˆ†å‰²ä¸ºkeyï¼Œvalueã€‚å¯ä»¥é€šè¿‡åœ¨é©±åŠ¨ç±»ä¸­è®¾ç½®åˆ†éš”ç¬¦ã€‚é»˜è®¤åˆ†éš”ç¬¦<code>\t</code>ã€‚</p>
<p><img src="https://i.loli.net/2020/06/27/uhMNsVke6iFP8oO.png" alt="image-20200627115321246"></p>
<h4 id="TextInputFormatçš„RecordReaderç”ŸæˆK-V"><a href="#TextInputFormatçš„RecordReaderç”ŸæˆK-V" class="headerlink" title="TextInputFormatçš„RecordReaderç”ŸæˆK-V"></a>TextInputFormatçš„RecordReaderç”ŸæˆK-V</h4><p><font color="red"><code>TextInputFormat</code>æ˜¯é»˜è®¤çš„FileInputFormatå®ç°ç±»ã€‚æŒ‰è¡Œè¯»å–æ¯æ¡è®°å½•ã€‚</font>å»ºæ˜¯å­˜å‚¨è¯¥è¡Œåœ¨æ•´ä¸ªæ–‡ä»¶ä¸­çš„èµ·å§‹å­—èŠ‚åç§»é‡ï¼Œ<code>LongWritable</code>ç±»å‹ï¼›å€¼æ˜¯è¿™è¡Œçš„å†…å®¹ï¼Œä¸åŒ…æ‹¬ä»»ä½•è¡Œç»ˆæ­¢ç¬¦(æ¢è¡Œç¬¦å’Œå›è½¦ç¬¦)ï¼Œ<code>Text</code>ç±»å‹ã€‚</p>
<p><img src="https://i.loli.net/2020/06/27/gAshOJRpqN8YM7E.png" alt="image-20200627120055534"></p>
<h4 id="NLineInputFormatçš„RecordReaderç”ŸæˆK-V"><a href="#NLineInputFormatçš„RecordReaderç”ŸæˆK-V" class="headerlink" title="NLineInputFormatçš„RecordReaderç”ŸæˆK-V"></a>NLineInputFormatçš„RecordReaderç”ŸæˆK-V</h4><p>å¦‚æœä½¿ç”¨<code>NLineInputFormat</code>ï¼Œä»£è¡¨æ¯ä¸ªmapè¿›ç¨‹å¤„ç†çš„<code>InputSpiltä¸å†æŒ‰ç…§Blockå—å»åˆ’åˆ†</code>ï¼Œè€Œæ˜¯æŒ‰ç…§<code>NLineInputFormat</code>æŒ‡å®šçš„è¡Œæ•°æ¥åˆ’åˆ†çš„ã€‚å³è¾“å…¥æ–‡ä»¶çš„æ€»è¡Œæ•°/N=åˆ‡ç‰‡æ•°ï¼Œå¦‚æœä¸æ•´é™¤ï¼Œåˆ‡ç‰‡æ•°=å•†+1.</p>
<p><img src="https://i.loli.net/2020/06/27/NFaighH4XodG8tk.png" alt="image-20200627121035864"></p>
<h3 id="è‡ªå®šä¹‰InputFormatğŸ”º"><a href="#è‡ªå®šä¹‰InputFormatğŸ”º" class="headerlink" title="è‡ªå®šä¹‰InputFormatğŸ”º"></a>è‡ªå®šä¹‰InputFormatğŸ”º</h3><p>åœ¨ä¼ä¸šå‘å¼€ä¸­ï¼ŒHadoopè‡ªå¸¦çš„InputFormatç±»å‹ä¸èƒ½æ»¡è¶³æ‰€æœ‰åº”ç”¨åœºæ™¯ï¼Œéœ€è¦è‡ªå®šä¹‰æ¥è§£å†³å®é™…é—®é¢˜ã€‚</p>
<p><strong>æ­¥éª¤ï¼š</strong></p>
<ol>
<li>è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿<code>FileInputFormat</code></li>
<li>è‡ªå®šä¹‰ä¸€ä¸ªç±»ç»§æ‰¿<code>RecordReader</code>ï¼Œå®ç°è¯»å–åˆ‡ç‰‡å½¢æˆK-V</li>
<li>å¦‚æœæƒ³æ”¹å˜åˆ‡ç‰‡æœºåˆ¶ï¼Œæ”¹å†™<code>WriteSpilts</code>æ–¹æ³•</li>
<li>åˆ‡ç‰‡æœºåˆ¶ä¸­éœ€è¦å…ˆåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ”¯æŒåˆ‡åˆ†ï¼Œæ˜¯å¦æ”¯æŒåˆ‡åˆ†æ˜¯è¿™ä¸ªå‡½æ•°<code>isSpiltable()</code></li>
<li>Driverç±»ä¸­è®¾ç½®ä½¿ç”¨è‡ªå®šä¹‰çš„InputFormat</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setInputFormatClass(xxxx.class);</span><br></pre></td></tr></table></figure>

<h2 id="MapReduceå·¥ä½œæµç¨‹"><a href="#MapReduceå·¥ä½œæµç¨‹" class="headerlink" title="MapReduceå·¥ä½œæµç¨‹"></a>MapReduceå·¥ä½œæµç¨‹</h2><p><img src="https://i.loli.net/2020/06/27/qv7MoCncyVRNKzd.png" alt="image-20200627121618614"></p>
<p><img src="https://i.loli.net/2020/06/27/jG2CRhwftTd1Nzv.png" alt="image-20200627121633037"></p>
<p>ä¸Šé¢çš„æµç¨‹æ˜¯æ•´ä¸ªMapReduceæœ€å…¨å·¥ä½œæµç¨‹ï¼Œä½†æ˜¯Shuffleè¿‡ç¨‹åªæ˜¯ä»ç¬¬7æ­¥å¼€å§‹åˆ°ç¬¬16æ­¥ç»“æŸï¼Œå…·ä½“Shuffleè¿‡ç¨‹è¯¦è§£ï¼Œå¦‚ä¸‹ï¼š</p>
<ol>
<li>MapTaskæ”¶é›†æˆ‘ä»¬çš„map()æ–¹æ³•è¾“å‡ºçš„kvå¯¹ï¼Œæ”¾åˆ°ç¯å½¢å†…å­˜ç¼“å†²åŒºä¸­(æ­¤æ—¶ä¼šè®¡ç®—åˆ†åŒºå·)ã€‚</li>
<li>ä»å†…å­˜ç¼“å†²åŒºä¸æ–­æº¢å‡ºæœ¬åœ°ç£ç›˜æ–‡ä»¶ï¼Œå¯èƒ½ä¼šæº¢å‡º(&gt;80Mæ—¶)å¤šä¸ªæ–‡ä»¶ã€‚æ­¤æ—¶å¦‚æœè®¾ç½®äº†Combineråˆ™æ’åºå®Œæˆåè¿˜ä¼šè¿›è¡ŒCombiner</li>
<li>å¤šä¸ªæº¢å‡ºæ–‡ä»¶ä¼šè¢«åˆå¹¶æˆå¤§çš„æº¢å‡ºæ–‡ä»¶ï¼Œå½’å¹¶æ’åºæŒ‰ç…§åˆ†åŒºå·å’Œkeyå€¼ï¼Œè¿™æ ·ä¿è¯åˆ†åŒºæ•°æ®è¢«ç‰¹å®šçš„ReduceTaskå¤„ç†ï¼Œå¹¶ä¸”æ ¹æ®Keyåˆ†ç»„ã€‚æ­¤æ—¶å¦‚æœè®¾ç½®äº†Combineråˆ™æ’åºå®Œæˆåè¿˜ä¼šè¿›è¡ŒCombiner</li>
<li>åœ¨æº¢å‡ºè¿‡ç¨‹åŠåˆå¹¶çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½è¦è°ƒç”¨Partitionerè¿›è¡Œåˆ†åŒºå’Œé’ˆå¯¹keyè¿›è¡Œæ’åº</li>
<li>ReduceTaskæ ¹æ®è‡ªå·±çš„åˆ†åŒºå·ï¼Œå»æ¯ä¸ªMapTaskæœºå™¨ä¸Šå–ç›¸åº”çš„ç»“æœåˆ†åŒºæ•°æ®</li>
<li>ReduceTaskä¼šå–åˆ°åŒä¸€ä¸ªåˆ†åŒºçš„æ¥è‡ªä¸åŒMapTaskçš„ç»“æœæ–‡ä»¶ï¼ŒReduceTaskä¼šå°†è¿™äº›æ–‡ä»¶å†è¿›è¡Œåˆå¹¶ï¼ˆå½’å¹¶æ’åºï¼‰</li>
<li>åˆå¹¶æˆå¤§æ–‡ä»¶åï¼ŒShuffleçš„è¿‡ç¨‹ä¹Ÿå°±ç»“æŸäº†ï¼Œåé¢è¿›å…¥ReduceTaskçš„é€»è¾‘è¿ç®—è¿‡ç¨‹ï¼ˆä»æ–‡ä»¶ä¸­å–å‡ºä¸€ä¸ªä¸€ä¸ªçš„é”®å€¼å¯¹Groupï¼Œè°ƒç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„reduce()æ–¹æ³•ï¼‰</li>
</ol>
<h2 id="Shuffleæœºåˆ¶"><a href="#Shuffleæœºåˆ¶" class="headerlink" title="Shuffleæœºåˆ¶"></a>Shuffleæœºåˆ¶</h2><p><strong>Shuffle</strong>å°±æ˜¯å°†æ¯ä¸ªMapè¾“å‡ºçš„æ•°æ®è¿›è¡Œè§„æ•´ï¼ŒåŒåŒä¸€åˆ†åŒºçš„æ•°æ®éƒ½å‘é€åˆ°æŒ‡å®šçš„ReduceTaskä¸­å»å¤„ç†ã€‚</p>
<p>Mapæ–¹æ³•ä¹‹åï¼ŒReduceæ–¹æ³•ä¹‹å‰çš„æ•°æ®å¤„ç†è¿‡ç¨‹ç§°ä¹‹ä¸ºShuffleã€‚å¦‚å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://i.loli.net/2020/06/27/HrkfelLnKDcav4B.png" alt="Snipaste_2020-06-27_12-43-49"></p>
<ol>
<li>MapTaské€šè¿‡<code>context</code>ä¸Šä¸‹æ–‡å†™å…¥æ—¶ï¼Œå†™åˆ°äº†ç¯å½¢ç¼“å†²åŒºã€‚ä¸€è¿›å…¥ç¼“å†²åŒºå°±ä¼šå¯¹KVè¿›è¡Œåˆ†åŒºï¼Œé»˜è®¤åˆ†åŒºæ˜¯<code>HashPartitoner</code>ï¼Œæˆä¸ºK-V-P</li>
<li>ç¯å½¢ç¼“å†²åŒºçš„æ•°æ®ä¼šå¯¹KVPè¿›è¡Œå¿«é€Ÿæ’åºï¼Œæ ¹æ®P-KäºŒæ¬¡æ’åº</li>
<li>ç¯å½¢ç¼“å†²åŒºçš„æ•°æ®å¤§äº80Mæ—¶ï¼Œä¼šæº¢å†™åˆ°ç£ç›˜ä¸­ã€‚å¦‚æœæ­¤æ—¶è®¾ç½®äº†Combiner(å®è´¨Reducer)çš„è¯ï¼Œä¼šå…ˆæ‰§è¡ŒCombineråæº¢å†™</li>
<li>å¤šä¸ªæº¢å†™çš„å°æ–‡ä»¶ä¼šè¿›è¡Œå½’å¹¶æ’åºå½¢æˆä¸€ä¸ªMapTaskçš„æœ€ç»ˆæ–‡ä»¶ã€‚ä¹Ÿæ˜¯æ ¹æ®P-Kæ¥äºŒæ¬¡æ’åºã€‚å¦‚æœæ­¤æ—¶è®¾ç½®äº†Combiner(å®è´¨Reducer)çš„è¯ï¼Œä¹Ÿä¼šæ‰§è¡ŒCombinerï¼ŒåŒæ—¶è¿›è¡Œ</li>
<li>æœ€åReducerTaskç«¯ä¼šè®¿é—®æ‰€æœ‰MapTaskçš„ç»“æœæ–‡ä»¶ï¼Œå–åˆ°æ­¤ReduceTaskéœ€è¦å¤„ç†çš„åˆ†åŒºæ–‡ä»¶</li>
<li>å¯¹å¤šä¸ªæ¬¡åˆ†åŒºçš„æ–‡ä»¶è¿›è¡Œå½’å¹¶æ’åºï¼Œæ ¹æ®Kï¼Œå› ä¸ºReduceTaské‡Œçš„æ•°æ®å…¨æ˜¯åŒä¸€åˆ†åŒºçš„ï¼Œç„¶åReduceç«¯å°±å¾—åˆ°äº†æ ¹æ®å¯ä»¥æ’å¥½åºçš„æ•°æ®</li>
<li>ç„¶è€Œï¼Œæˆ‘ä»¬ReducerTaskçš„å¤„ç†ç²’åº¦æ˜¯k-Itorable<V>ï¼Œæ‰€ä»¥ReduceTaskè¿˜éœ€è¦å¯¹keyè¿›è¡Œåˆ†ç»„ã€‚</li>
<li>è¿™é‡Œæˆ‘ä»¬å¯æ˜¯ä½¿ç”¨é»˜è®¤çš„ï¼Œå°±æ˜¯å€¼ç›¸åŒä¸ºä¸€ç»„ï¼›ä¹Ÿå¯ä»¥è‡ªå®šä¹‰<code>GroupingComparator</code>è®¾ç½®åˆ†ç»„è§„åˆ™ã€‚</li>
<li>åˆ†ç»„å®ä¸Šå°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªç›¸åŒå°±å½’ä¸ºä¸€ç»„ï¼Œå¦åˆ™ä¸åŒç»„ã€‚ä¸ºä»€ä¹ˆè¿™æ ·å°±å¯ä»¥ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„Keyæ˜¯å·²ç»æ’å¥½åºçš„ï¼Œè¿™æ ·keyç›¸åŒçš„æ•°æ®å¿…ç„¶æ˜¯è¿ç»­çš„ã€‚</li>
<li>æ‰§è¡ŒReduceTaskçš„ä¸šåŠ¡é€»è¾‘</li>
<li>å¤šä¸ªReduceTaskçš„ç»“æœè¿›è¡Œæ±‡æ€»ï¼Œå¾—åˆ°æœ€æ€»æ•°æ®ï¼</li>
</ol>
<h3 id="Partitonåˆ†åŒº"><a href="#Partitonåˆ†åŒº" class="headerlink" title="Partitonåˆ†åŒº"></a>Partitonåˆ†åŒº</h3><p> å‰é¢è¯´åˆ°MapTaskçš„å¹¶è¡Œåº¦ç”±æ•°æ®çš„åˆ‡ç‰‡æ•°å†³å®šã€‚</p>
<p>è€ŒReduceTaskçš„å¹¶è¡Œåº¦ç”±Partionåˆ†åŒºå†³å®šï¼Œå¿…é¡»é€šè¿‡åœ¨Driveré©±åŠ¨ç±»æ‰‹åŠ¨è®¾ç½®æˆ–è€…ä¿®æ”¹é»˜è®¤é…ç½®ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¯´ReduceTaskçš„å¹¶è¡Œåº¦ç”±Partionåˆ†åŒºå†³å®šå‘¢ï¼Ÿ</p>
<p>å¦‚æœPartionåˆ†åŒºå™¨ç»™ä½ åˆ†äº†5ä¸ªåŒºï¼Œè€Œä½ æ²¡æœ‰è®¾ç½®ReduceTaskçš„å¹¶è¡Œåº¦(é»˜è®¤1)ï¼Œå°±ä¼šæŠ¥é”™ï¼å½“ç„¶ReduceTaskçš„å¹¶è¡Œåº¦å¯ä»¥å¤§çº¦5ä¸ªåŒºï¼Œä½†æ˜¯æœ€æ€»ç»“æœåªæœ‰5ä¸ªåŒºæœ‰æ•°æ®ï¼Œå¤šä½™çš„åŒºä¸ä¼šç”¨åˆ°ï¼Œæµªè´¹ã€‚æ‰€ä»¥ReduceTaskçš„å¹¶è¡Œåº¦=Partionåˆ†åŒºå™¨åˆ†çš„åŒºã€‚<font color="red">å…¶ä¸­Partionåˆ†åŒºå™¨åˆ†çš„åŒºçš„åŒºå·ï¼Œ<strong>å¿…é¡»æ˜¯ä»0å¼€å§‹ï¼Œé€ä¸€é€’å¢ï¼ï¼</strong></font>å› ä¸ºæˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ReduceTaskçš„å¹¶è¡Œåº¦ä¸º5æ—¶ï¼Œå®ƒäº§ç”Ÿçš„åˆ†åŒºå°±æ˜¯0-4ã€‚</p>
<p>psï¼šåˆ†åŒºå™¨åˆ†äº†å‡ ä¸ªåŒºï¼Œæœ€ç»ˆç»“æœå°±æœ‰å‡ ä¸ªæ–‡ä»¶æœ‰å†…å®¹ã€‚</p>
<h4 id="é»˜è®¤åˆ†åŒºå™¨"><a href="#é»˜è®¤åˆ†åŒºå™¨" class="headerlink" title="é»˜è®¤åˆ†åŒºå™¨"></a>é»˜è®¤åˆ†åŒºå™¨</h4><p><img src="https://i.loli.net/2020/06/27/V51zjlWTCtGd3Dh.png" alt="image-20200627130939155"></p>
<h4 id="è‡ªå®šä¹‰åˆ†åŒºå™¨ğŸ”º"><a href="#è‡ªå®šä¹‰åˆ†åŒºå™¨ğŸ”º" class="headerlink" title="è‡ªå®šä¹‰åˆ†åŒºå™¨ğŸ”º"></a>è‡ªå®šä¹‰åˆ†åŒºå™¨ğŸ”º</h4><ol>
<li>è‡ªå®šä¹‰ç±»ç»§æ‰¿<code>Partitioner</code>ï¼Œé‡å†™<code>getPartition()</code></li>
<li>Jobé©±åŠ¨ä¸­ï¼Œè®¾ç½®è‡ªå®šä¹‰Partitonerï¼›<code>job.setPartitionerClass(xxx.class)</code></li>
<li>è‡ªå®šä¹‰<code>Partitioner</code>åï¼Œéœ€è¦æ ¹æ®å®ƒçš„é€»è¾‘æ¥è®¾ç½®ç›¸åº”æ•°é‡çš„ReduceTaskï¼›<code>job.setNumReduceTasks(n)</code></li>
</ol>
<h4 id="åˆ†åŒºæ€»ç»“"><a href="#åˆ†åŒºæ€»ç»“" class="headerlink" title="åˆ†åŒºæ€»ç»“"></a>åˆ†åŒºæ€»ç»“</h4><ol>
<li>å¦‚æœReduceTaskçš„æ•°é‡&gt;getPartitonçš„ç»“æœæ•°ï¼Œåˆ™ä¼šå¤šäº§ç”Ÿå‡ ä¸ªç©ºçš„è¾“å‡ºæ–‡ä»¶part-r-000xx;</li>
<li>å¦‚æœ1&lt;ReduceTaskçš„æ•°é‡&lt;getPartitonçš„ç»“æœæ•°ï¼Œåˆ™æœ‰ä¸€éƒ¨åˆ†åˆ†åŒºæ•°æ®æ— æ³•å®‰æ”¾ï¼Œä¼šException</li>
<li>å¦‚æœ1=ReduceTaskçš„æ•°é‡ï¼Œä¸ç®¡å¤šå°‘ä¸ªåˆ†åŒºï¼Œæœ€åäº§ç”Ÿä¸€ä¸ªReduceTaskï¼Œæœ€ç»ˆä¸€ä¸ªç»“æœæ–‡ä»¶</li>
<li>åˆ†åŒºå·å¿…é¡»ä»0å¼€å§‹ï¼Œé€ä¸€ç´¯åŠ </li>
</ol>
<h3 id="WritableComparableæ’åº"><a href="#WritableComparableæ’åº" class="headerlink" title="WritableComparableæ’åº"></a>WritableComparableæ’åº</h3><p>æ’åºæ—¶MapReduceæ¡†æ¶ä¸­æœ€é‡è¦çš„æ“ä½œä¹‹ä¸€ã€‚æ˜¯ReduceTaskèƒ½<strong>æŠŠç›¸åŒKeyåˆ†ç»„è¿™ä¸ªæ“ä½œçš„åŸºçŸ³</strong>ï¼ï¼</p>
<p>å› ä¸ºReduceTaskçš„åˆ†ç»„ä¸æ˜¯ä¸€ä¸ªä¸ªåˆ†çš„ï¼Œå› ä¸ºå¤§æ•°æ®æƒ…å†µä¸‹å¾ˆæ…¢ã€‚è¿˜å¯èƒ½ä¼šçˆ†æ‰ã€‚Hadoopé€šè¿‡ä¸‰æ¬¡æ’åº(ç¯å½¢ç¼“å†²åŒºæ—¶ã€æº¢å†™å¤§æ–‡ä»¶æ—¶ã€ReduceTaskä»å„ä¸ªMapTaskè·å–ç‰¹å®šåˆ†åŒºæ•°æ®æ—¶)ï¼Œå½“ReduceTaskè·å–åˆ°æ•°æ®æ—¶ï¼Œæ•°æ®çš„é¡ºåºæ˜¯æ ¹æ®keyæ’å¥½çš„(ç›¸åŒkeyæ¯”ç›¸é‚»)ï¼Œæ‰€ä»¥åªéœ€è¦ç¼–å†™ä¸€ä¸ªkeyçš„æ¯”è¾ƒå™¨å³å¯ï¼Œå¦‚æœæ¯”è¾ƒå™¨è¿”å›0ï¼Œåˆ™å½’ä¸ºåŒä¸€ç»„ï¼Œå¦åˆ™ä¸åŒç»„</p>
<p>é»˜è®¤æ’åºæ˜¯æŒ‰ç…§å­—å…¸é¡ºåºæ’åºçš„ï¼Œå¦‚æœä½ çš„keyæ˜¯ä¸€ä¸ªbeanï¼Œé‚£ä¹ˆä½ å°±å¿…é¡»å¾—åœ¨beanä¸­æŒ‡å®šbeançš„æ’åºè§„åˆ™ï¼Œç„¶ååœ¨GroupingComparatorä¸­æŒ‡å®šåˆ†ç»„è§„åˆ™ã€‚æ’åºè§„åˆ™å¿…é¡»åŒ…å«åˆ†ç»„è§„åˆ™ï¼Œè€Œä¸”å…ˆæŒ‰ç…§åˆ†ç»„è§„åˆ™æ’ä¸€ä¸‹åºï¼Œå†æ’å…¶ä»–ã€‚å¦åˆ™å°±ä¼šå¯¼è‡´ReduceTaskåˆ†ç»„æ•ˆæœå¤±è´¥ã€‚</p>
<h4 id="æ’åºçš„åˆ†ç±»"><a href="#æ’åºçš„åˆ†ç±»" class="headerlink" title="æ’åºçš„åˆ†ç±»"></a>æ’åºçš„åˆ†ç±»</h4><p><img src="https://i.loli.net/2020/06/27/MuGgZNohnFyT57c.png" alt="image-20200627133002336"></p>
<h4 id="è‡ªå®šä¹‰æ’åºWritableComparableğŸ”º"><a href="#è‡ªå®šä¹‰æ’åºWritableComparableğŸ”º" class="headerlink" title="è‡ªå®šä¹‰æ’åºWritableComparableğŸ”º"></a>è‡ªå®šä¹‰æ’åºWritableComparableğŸ”º</h4><p>beanå¯¹è±¡åšä¸ºkeyä¼ è¾“ï¼Œéœ€è¦å®ç°WritableComparableæ¥å£é‡å†™compareToæ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°æ’åºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(FlowBean o)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> result;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">// æŒ‰ç…§æ€»æµé‡å¤§å°ï¼Œå€’åºæ’åˆ—</span></span><br><span class="line">    <span class="keyword">if</span> (sumFlow &gt; bean.getSumFlow()) &#123;</span><br><span class="line">        result = -<span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (sumFlow &lt; bean.getSumFlow()) &#123;</span><br><span class="line">        result = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        result = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="GroupingComparatoråˆ†ç»„ï¼ˆè¾…åŠ©æ’åºï¼‰"><a href="#GroupingComparatoråˆ†ç»„ï¼ˆè¾…åŠ©æ’åºï¼‰" class="headerlink" title="GroupingComparatoråˆ†ç»„ï¼ˆè¾…åŠ©æ’åºï¼‰"></a>GroupingComparatoråˆ†ç»„ï¼ˆè¾…åŠ©æ’åºï¼‰</h3><p>ä¸Šé¢è¯´åˆ°beanä½œä¸ºkeyæ—¶å€™çš„æ’åºï¼Œé‚£ä¹ˆGroupingComparatorå°±æ˜¯ReduceTaskç«¯beanåšä¸ºkeyæ—¶çš„åˆ†ç»„(æ’åº)</p>
<p>Hadoopé€šè¿‡ä¸‰æ¬¡æ’åº(ç¯å½¢ç¼“å†²åŒºæ—¶ã€æº¢å†™å¤§æ–‡ä»¶æ—¶ã€ReduceTaskä»å„ä¸ªMapTaskè·å–ç‰¹å®šåˆ†åŒºæ•°æ®æ—¶)ï¼Œå½“ReduceTaskè·å–åˆ°æ•°æ®æ—¶ï¼Œæ•°æ®çš„é¡ºåºæ˜¯æ ¹æ®keyæ’å¥½çš„(ç›¸åŒkeyæ¯”ç›¸é‚»)ï¼Œæ‰€ä»¥åªéœ€è¦ç¼–å†™ä¸€ä¸ªkeyçš„æ¯”è¾ƒå™¨å³å¯ï¼Œå¦‚æœæ¯”è¾ƒå™¨è¿”å›0ï¼Œåˆ™å½’ä¸ºåŒä¸€ç»„ï¼Œå¦åˆ™ä¸åŒç»„</p>
<h4 id="è‡ªå®šä¹‰åˆ†ç»„ğŸ”º"><a href="#è‡ªå®šä¹‰åˆ†ç»„ğŸ”º" class="headerlink" title="è‡ªå®šä¹‰åˆ†ç»„ğŸ”º"></a>è‡ªå®šä¹‰åˆ†ç»„ğŸ”º</h4><ol>
<li>ä½œä¸ºkeyçš„beanå¿…é¡»å®ç°äº†<code>WritableComparable</code>æ¥å£ï¼Œå¹¶å®ç°äº†ç›¸å…³æ–¹æ³•</li>
<li>ç¼–å†™åˆ†ç»„æ’åºç±»ç»§æ‰¿<code>WritableComparator</code>ï¼Œç¼–å†™keyçš„beanç±»å‹çš„(åˆ†ç»„)æ¯”è¾ƒæ–¹æ³•</li>
<li>åˆ†ç»„æ’åºç±»é¢å¤–éœ€è¦åˆ›å»ºä¸€ä¸ªæ„é€ å°†æ¯”è¾ƒå¯¹è±¡çš„ç±»ä¼ ç»™çˆ¶ç±»ğŸ”º</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">xxx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(OrderBean.class, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Driveré©±åŠ¨ç±»ä¸­<code>job.setGroupingComparatorClass(xxx.class)</code></li>
</ol>
<h3 id="Combiner"><a href="#Combiner" class="headerlink" title="Combiner"></a>Combiner</h3><p><img src="https://i.loli.net/2020/06/27/5pkt1imEhJ2ZVDv.png" alt="image-20200627133822658"></p>
<h4 id="è‡ªå®šä¹‰Combiner"><a href="#è‡ªå®šä¹‰Combiner" class="headerlink" title="è‡ªå®šä¹‰Combiner"></a>è‡ªå®šä¹‰Combiner</h4><ol>
<li>å’ŒReduceä¸€æ ·ï¼Œç»§æ‰¿Reducerï¼Œé‡å†™Reduceæ–¹æ³•</li>
<li>åœ¨Jobé©±åŠ¨ç±»ä¸­è®¾ç½®ï¼š<code>job.setCombinerClass(WordcountCombiner.class)</code></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Xiangjie</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://awslzhang.top/2020/06/26/MapReduce%E5%8E%9F%E7%90%86/">https://awslzhang.top/2020/06/26/MapReduce%E5%8E%9F%E7%90%86/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://awslzhang.top" target="_blank">zxj</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Hadoop/">Hadoop</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/06/27/2xbLZqNQKHGoUu1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/07/02/Hive%E6%A6%82%E8%BF%B0/"><img class="prev-cover" src="https://i.loli.net/2020/07/02/LEKTZ49OFH5Jo3C.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Hiveæ¦‚è¿°</div></div></a></div><div class="next-post pull-right"><a href="/2020/06/22/HDFS%E6%A6%82%E8%BF%B0/"><img class="next-cover" src="https://i.loli.net/2020/06/22/xIQlAhrgUHqSa27.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">HDFSæ¦‚è¿°</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2020/07/15/Oozieè°ƒåº¦/" title="Oozieè°ƒåº¦"><img class="cover" src="https://zxj-typora.oss-cn-shanghai.aliyuncs.com/img/Oozie-logo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-15</div><div class="title">Oozieè°ƒåº¦</div></div></a></div><div><a href="/2020/07/14/Sqoopçš„ç®€å•ä½¿ç”¨/" title="Sqoopçš„ç®€å•ä½¿ç”¨"><img class="cover" src="https://zxj-typora.oss-cn-shanghai.aliyuncs.com/img/sqoop-logo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-14</div><div class="title">Sqoopçš„ç®€å•ä½¿ç”¨</div></div></a></div><div><a href="/2020/07/04/FlumeåŸºæœ¬ä½¿ç”¨/" title="FlumeåŸºæœ¬ä½¿ç”¨"><img class="cover" src="https://i.loli.net/2020/07/04/FjyZ6DdUigWebJn.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-04</div><div class="title">FlumeåŸºæœ¬ä½¿ç”¨</div></div></a></div><div><a href="/2020/06/22/HDFSæ¦‚è¿°/" title="HDFSæ¦‚è¿°"><img class="cover" src="https://i.loli.net/2020/06/22/xIQlAhrgUHqSa27.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-22</div><div class="title">HDFSæ¦‚è¿°</div></div></a></div><div><a href="/2020/06/22/Hadoopç¼–è¯‘å®‰è£…/" title="Hadoopç¼–è¯‘å®‰è£…"><img class="cover" src="https://i.loli.net/2020/06/22/Wb7kUVafmZSOudC.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-22</div><div class="title">Hadoopç¼–è¯‘å®‰è£…</div></div></a></div><div><a href="/2020/07/02/Hiveæ¦‚è¿°/" title="Hiveæ¦‚è¿°"><img class="cover" src="https://i.loli.net/2020/07/02/LEKTZ49OFH5Jo3C.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-02</div><div class="title">Hiveæ¦‚è¿°</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Xiangjie</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">85</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">43</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">25</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/XiangJie-Zhang" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:qluzxj@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MapReduce%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">MapReduceæ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReduce%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.</span> <span class="toc-text">MapReduceå®šä¹‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReduce%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.2.</span> <span class="toc-text">MapReduceä¼˜ç¼ºç‚¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReudce%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">MapReudceæµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReduce%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">MapReduceè¿›ç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReduce%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.5.</span> <span class="toc-text">MapReduceåºåˆ—åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89bean%E5%AF%B9%E8%B1%A1%E5%AE%9E%E7%8E%B0%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A5%E5%8F%A3%EF%BC%88Writable%EF%BC%89"><span class="toc-number">1.5.1.</span> <span class="toc-text">è‡ªå®šä¹‰beanå¯¹è±¡å®ç°åºåˆ—åŒ–æ¥å£ï¼ˆWritableï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReduce%E7%BC%96%E7%A8%8B%E8%A7%84%E8%8C%83"><span class="toc-number">1.6.</span> <span class="toc-text">MapReduceç¼–ç¨‹è§„èŒƒ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%B1%95%E7%A4%BAwordcount"><span class="toc-number">1.6.1.</span> <span class="toc-text">ä»£ç å±•ç¤ºwordcount</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Driver%E4%BC%98%E5%8C%96%E5%86%99%E6%B3%95"><span class="toc-number">1.6.2.</span> <span class="toc-text">Driverä¼˜åŒ–å†™æ³•</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MapReduce%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">MapReduceæ¡†æ¶åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#InputFormat"><span class="toc-number">2.1.</span> <span class="toc-text">InputFormat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FileInputFormat%E5%88%87%E7%89%87"><span class="toc-number">2.1.1.</span> <span class="toc-text">FileInputFormatåˆ‡ç‰‡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#FileInputFormat%E5%88%87%E7%89%87%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">FileInputFormatåˆ‡ç‰‡æœºåˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CombineTextInputFormat%E5%88%87%E7%89%87%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">CombineTextInputFormatåˆ‡ç‰‡æœºåˆ¶</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FileInputFormat%E7%9A%84RecordReader%E7%94%9F%E6%88%90K-V"><span class="toc-number">2.1.2.</span> <span class="toc-text">FileInputFormatçš„RecordReaderç”ŸæˆK-V</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#KeyValueTextInputFormat%E7%9A%84RecordReader%E7%94%9F%E6%88%90K-V"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">KeyValueTextInputFormatçš„RecordReaderç”ŸæˆK-V</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TextInputFormat%E7%9A%84RecordReader%E7%94%9F%E6%88%90K-V"><span class="toc-number">2.1.2.2.</span> <span class="toc-text">TextInputFormatçš„RecordReaderç”ŸæˆK-V</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NLineInputFormat%E7%9A%84RecordReader%E7%94%9F%E6%88%90K-V"><span class="toc-number">2.1.2.3.</span> <span class="toc-text">NLineInputFormatçš„RecordReaderç”ŸæˆK-V</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89InputFormat%F0%9F%94%BA"><span class="toc-number">2.1.3.</span> <span class="toc-text">è‡ªå®šä¹‰InputFormatğŸ”º</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MapReduce%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">MapReduceå·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shuffle%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.</span> <span class="toc-text">Shuffleæœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Partiton%E5%88%86%E5%8C%BA"><span class="toc-number">2.3.1.</span> <span class="toc-text">Partitonåˆ†åŒº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E5%88%86%E5%8C%BA%E5%99%A8"><span class="toc-number">2.3.1.1.</span> <span class="toc-text">é»˜è®¤åˆ†åŒºå™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E5%8C%BA%E5%99%A8%F0%9F%94%BA"><span class="toc-number">2.3.1.2.</span> <span class="toc-text">è‡ªå®šä¹‰åˆ†åŒºå™¨ğŸ”º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8C%BA%E6%80%BB%E7%BB%93"><span class="toc-number">2.3.1.3.</span> <span class="toc-text">åˆ†åŒºæ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WritableComparable%E6%8E%92%E5%BA%8F"><span class="toc-number">2.3.2.</span> <span class="toc-text">WritableComparableæ’åº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">æ’åºçš„åˆ†ç±»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8FWritableComparable%F0%9F%94%BA"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">è‡ªå®šä¹‰æ’åºWritableComparableğŸ”º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GroupingComparator%E5%88%86%E7%BB%84%EF%BC%88%E8%BE%85%E5%8A%A9%E6%8E%92%E5%BA%8F%EF%BC%89"><span class="toc-number">2.3.3.</span> <span class="toc-text">GroupingComparatoråˆ†ç»„ï¼ˆè¾…åŠ©æ’åºï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%BB%84%F0%9F%94%BA"><span class="toc-number">2.3.3.1.</span> <span class="toc-text">è‡ªå®šä¹‰åˆ†ç»„ğŸ”º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Combiner"><span class="toc-number">2.3.4.</span> <span class="toc-text">Combiner</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89Combiner"><span class="toc-number">2.3.4.1.</span> <span class="toc-text">è‡ªå®šä¹‰Combiner</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/01/10/Api%E5%92%8CSQL/" title="Apiå’ŒSQL"><img src="https://flink.apache.org/img/flink-header-logo.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Apiå’ŒSQL"/></a><div class="content"><a class="title" href="/2021/01/10/Api%E5%92%8CSQL/" title="Apiå’ŒSQL">Apiå’ŒSQL</a><time datetime="2021-01-10T03:51:40.000Z" title="å‘è¡¨äº 2021-01-10 11:51:40">2021-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/02/Flink%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/" title="FlinkçŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶"><img src="https://flink.apache.org/img/flink-header-logo.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="FlinkçŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶"/></a><div class="content"><a class="title" href="/2021/01/02/Flink%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/" title="FlinkçŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶">FlinkçŠ¶æ€ç¼–ç¨‹å’Œå®¹é”™æœºåˆ¶</a><time datetime="2021-01-02T10:06:02.000Z" title="å‘è¡¨äº 2021-01-02 18:06:02">2021-01-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/23/Flink%E6%97%B6%E9%97%B4%E8%AF%AD%E4%B9%89%E5%92%8CWaterMark/" title="Flinkçš„æ—¶é—´è¯­ä¹‰å’Œwatermark"><img src="https://flink.apache.org/img/flink-header-logo.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Flinkçš„æ—¶é—´è¯­ä¹‰å’Œwatermark"/></a><div class="content"><a class="title" href="/2020/12/23/Flink%E6%97%B6%E9%97%B4%E8%AF%AD%E4%B9%89%E5%92%8CWaterMark/" title="Flinkçš„æ—¶é—´è¯­ä¹‰å’Œwatermark">Flinkçš„æ—¶é—´è¯­ä¹‰å’Œwatermark</a><time datetime="2020-12-23T10:59:07.000Z" title="å‘è¡¨äº 2020-12-23 18:59:07">2020-12-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/17/Flink-API/" title="Flink Apiå­¦ä¹ "><img src="https://flink.apache.org/img/flink-header-logo.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Flink Apiå­¦ä¹ "/></a><div class="content"><a class="title" href="/2020/12/17/Flink-API/" title="Flink Apiå­¦ä¹ ">Flink Apiå­¦ä¹ </a><time datetime="2020-12-17T12:36:28.000Z" title="å‘è¡¨äº 2020-12-17 20:36:28">2020-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/12/17/ready/" title="ready!"><img src="https://images.pexels.com/photos/924824/pexels-photo-924824.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ready!"/></a><div class="content"><a class="title" href="/2020/12/17/ready/" title="ready!">ready!</a><time datetime="2020-12-16T16:02:06.000Z" title="å‘è¡¨äº 2020-12-17 00:02:06">2020-12-17</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Xiangjie</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script></div></body></html>